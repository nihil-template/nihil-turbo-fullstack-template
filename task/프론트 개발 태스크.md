# `apps/web` UI 라우트 구조 (Next.js App Router) - 투두리스트

`apps/api`의 API 엔드포인트를 기반으로 `apps/web`의 UI 라우트 구조를 Next.js App Router 형식에 맞게 설계합니다.

## 현재 디렉토리 구조

```
apps/web/app/
├── (auth)/                      // 인증 관련 페이지 그룹 (URL에 영향을 주지 않음)
│   ├── layout.tsx               // 인증 관련 공통 레이아웃 ✅
│   ├── _components/             // 인증 관련 공통 컴포넌트
│   ├── _layouts/                // 인증 관련 레이아웃
│   └── auth/                    // 인증 페이지들
│       ├── layout.tsx           // 인증 페이지 공통 레이아웃 ✅
│       ├── signin/
│       │   ├── page.tsx         // 로그인 페이지 (URL: /auth/signin) ✅
│       │   └── _components/
│       │       └── SignInForm.tsx ✅
│       ├── signup/
│       │   ├── page.tsx         // 회원가입 페이지 (URL: /auth/signup) ✅
│       │   └── _components/
│       │       └── SignUpForm.tsx ✅
│       ├── forgot-password/
│       │   ├── page.tsx         // 비밀번호 찾기 페이지 (URL: /auth/forgot-password) ✅
│       │   └── _components/
│       │       └── ForgotPasswordForm.tsx ✅
│       └── new-password/
│           ├── page.tsx         // 새 비밀번호 설정 페이지 (URL: /auth/new-password) ✅
│           └── _components/
│               └── NewPasswordForm.tsx ✅
│
├── (profile)/                   // 사용자 프로필 및 계정 관리 그룹
│   └── profile/
│       ├── page.tsx             // 내 프로필 조회 페이지 (URL: /profile) ❌ (빈 파일)
│       ├── _components/         // 프로필 관련 컴포넌트
│       ├── edit/
│       │   ├── page.tsx         // 내 프로필 수정 페이지 (URL: /profile/edit) ⚠️ (구현됨 but API 호환성 문제)
│       │   └── _components/
│       │       └── ProfileEditForm.tsx ⚠️ (구현됨 but API 호환성 문제)
│       │   └── change-password/
│       │       └── page.tsx     // 비밀번호 변경 페이지 (URL: /profile/edit/change-password) ❌ (빈 파일)
│       └── withdraw/
│           └── page.tsx         // 회원 탈퇴 페이지 (URL: /profile/withdraw) ❌ (빈 파일)
│
├── (common)/                    // 공통 페이지 그룹
│   ├── layout.tsx               // 공통 레이아웃
│   ├── page.tsx                 // 메인 홈 페이지 (URL: /) ✅
│   ├── _components/             // 공통 컴포넌트
│   │   ├── Home.tsx             // 홈 컴포넌트 ✅
│   │   └── ui/                  // shadcn/ui 컴포넌트들 ✅
│   └── _layouts/                // 공통 레이아웃
│       └── AuthButtons.tsx      // 인증 버튼 컴포넌트 ✅ (세션 관리 포함)
│
├── _entities/                   // 도메인별 엔티티 (훅, 타입, 스토어) ✅
│   ├── auth/                    // 인증 관련 엔티티 ✅
│   │   ├── auth.types.ts        // 인증 타입 정의 ✅
│   │   ├── auth.store.ts        // 인증 상태 관리 ✅
│   │   ├── auth.keys.ts         // 쿼리 키 관리 ✅
│   │   └── hooks/               // 인증 관련 훅 ✅
│   │       ├── useSignIn.ts     // 로그인 훅 ✅
│   │       ├── useSignUp.ts     // 회원가입 훅 ✅
│   │       ├── useSignOut.ts    // 로그아웃 훅 ✅
│   │       ├── useGetSession.ts // 세션 조회 훅 ✅
│   │       ├── useChangePassword.ts // 비밀번호 변경 훅 ✅
│   │       ├── useWithdraw.ts   // 회원탈퇴 훅 ✅
│   │       ├── useForgotPassword.ts // 비밀번호 찾기 훅 ✅
│   │       └── useNewPassword.ts // 새 비밀번호 설정 훅 ✅
│   └── users/                   // 사용자 관련 엔티티 ✅
│       ├── users.types.ts       // 사용자 타입 정의 ✅
│       ├── users.keys.ts        // 쿼리 키 관리 ✅
│       └── hooks/               // 사용자 관련 훅 ✅
│           ├── useGetUsers.ts   // 사용자 목록 조회 훅 ✅
│           ├── useGetUser.ts    // 특정 사용자 조회 훅 ✅
│           ├── useGetProfile.ts // 프로필 조회 훅 ✅
│           └── useUpdateProfile.ts // 프로필 수정 훅 ✅
├── _libs/                       // 공통 라이브러리 ✅
├── _styles/                     // 전역 스타일 ✅
├── _data/                       // 정적 데이터 ✅
├── _icons/                      // 아이콘 컴포넌트 ✅
├── _layouts/                    // 전역 레이아웃 ✅
├── layout.tsx                   // 최상위 공통 레이아웃 ✅
├── not-found.tsx                // 404 페이지 ✅
├── config.ts                    // 앱 설정 ✅
├── opengraph-image.png          // OG 이미지 ✅
└── twitter-image.png            // Twitter 이미지 ✅
```

## 라우트 상세 설명

### 1. 인증 (Auth) 라우트 ✅ 완료

- **로그인**: `/auth/signin` ✅
  - 파일 경로: `app/(auth)/auth/signin/page.tsx`
  - 상태: 구현 완료 (홈 링크 포함)
- **회원가입**: `/auth/signup` ✅
  - 파일 경로: `app/(auth)/auth/signup/page.tsx`
  - 상태: 구현 완료 (홈 링크 포함)
- **비밀번호 찾기**: `/auth/forgot-password` ✅
  - 파일 경로: `app/(auth)/auth/forgot-password/page.tsx`
  - 상태: 구현 완료 (홈 링크 포함)
- **새 비밀번호 설정**: `/auth/new-password` ✅
  - 파일 경로: `app/(auth)/auth/new-password/page.tsx`
  - 상태: 구현 완료 (홈 링크 포함)

### 2. 프로필 (Profile) 라우트 ⚠️ 부분 완료

- **내 프로필 조회**: `/profile` ❌
  - 파일 경로: `app/(profile)/profile/page.tsx`
  - 상태: 빈 파일 (구현 필요)
- **내 프로필 수정**: `/profile/edit` ⚠️
  - 파일 경로: `app/(profile)/profile/edit/page.tsx`
  - 상태: 구현 완료 but API 호환성 문제로 작동하지 않음
- **비밀번호 변경**: `/profile/edit/change-password` ❌
  - 파일 경로: `app/(profile)/profile/edit/change-password/page.tsx`
  - 상태: 빈 파일 (구현 필요)
- **회원 탈퇴**: `/profile/withdraw` ❌
  - 파일 경로: `app/(profile)/profile/withdraw/page.tsx`
  - 상태: 빈 파일 (구현 필요)

### 3. 공통 (Common) 라우트 ✅ 완료

- **메인 홈**: `/` ✅
  - 파일 경로: `app/(common)/page.tsx`
  - 상태: 구현 완료
- **세션 관리 UI**: ✅
  - 파일 경로: `app/(common)/_layouts/AuthButtons.tsx`
  - 상태: 구현 완료 (로그인/로그아웃 버튼, 사용자 정보 표시)

## 현재 문제점 및 이슈

### 🔴 긴급 해결 필요

#### 1. Zod 호환성 문제 ⚠️

**문제**: `nestjs-zod`와 `@nest-zod/z` 패키지가 Zod v4와 호환되지 않음

- **현상**: 프로필 수정 시 `zod.defaultErrorMap is not a function` 에러 발생
- **영향**: 프로필 수정 페이지가 구현되었지만 API 호출 시 500 에러 발생
- **해결 방안**:
  1. nestjs-zod 제거 후 직접 Zod 검증 구현
  2. 또는 Zod v3로 다운그레이드 (임시 해결책)

#### 2. 프로필 수정 기능 미완성 ❌

**문제**: UI는 완료되었지만 백엔드 API 호환성 문제로 작동하지 않음

- **현재 상태**:
  - ✅ `ProfileEditForm.tsx` 컴포넌트 구현 완료
  - ✅ `useUpdateProfile` 훅 구현 완료
  - ✅ 백엔드 `PUT /users/profile` API 구현 완료
  - ❌ Zod 검증 파이프에서 에러 발생

## 구현 투두리스트

### 🔴 높은 우선순위 (필수 구현)

#### 1. Zod 호환성 문제 해결

- [ ] **nestjs-zod 제거 또는 대체**
  - [ ] nestjs-zod 제거
  - [ ] 직접 Zod 검증 파이프 구현
  - [ ] 또는 Zod v3로 다운그레이드

- [ ] **프로필 수정 기능 정상화**
  - [ ] API 호환성 문제 해결
  - [ ] 프로필 수정 테스트
  - [ ] 에러 처리 개선

#### 2. 프로필 관리 페이지들

- [ ] **프로필 조회 페이지** (`/profile`)
  - [ ] `app/(profile)/profile/page.tsx` 구현
  - [ ] `app/(profile)/profile/_components/ProfileView.tsx` 생성
  - [ ] 사용자 정보 표시 (이름, 이메일, 역할)
  - [ ] 프로필 수정 링크
  - [ ] 비밀번호 변경 링크
  - [ ] 회원탈퇴 링크

- [x] **프로필 수정 페이지** (`/profile/edit`) ⚠️
  - [x] `app/(profile)/profile/edit/page.tsx` 구현
  - [x] `app/(profile)/profile/edit/_components/ProfileEditForm.tsx` 생성
  - [x] 사용자명 수정 기능
  - [x] 이메일 수정 기능 (선택사항)
  - [x] `useUpdateProfile` 훅 연동
  - [ ] API 호환성 문제 해결 필요

- [ ] **비밀번호 변경 페이지** (`/profile/edit/change-password`)
  - [ ] `app/(profile)/profile/edit/change-password/page.tsx` 구현
  - [ ] `app/(profile)/profile/edit/change-password/_components/ChangePasswordForm.tsx` 생성
  - [ ] 현재 비밀번호 입력
  - [ ] 새 비밀번호 입력
  - [ ] 새 비밀번호 확인
  - [ ] `useChangePassword` 훅 연동

- [ ] **회원탈퇴 페이지** (`/profile/withdraw`)
  - [ ] `app/(profile)/profile/withdraw/page.tsx` 구현
  - [ ] `app/(profile)/profile/withdraw/_components/WithdrawForm.tsx` 생성
  - [ ] 회원탈퇴 확인 절차
  - [ ] 비밀번호 재확인
  - [ ] `useWithdraw` 훅 연동

#### 3. 세션 관리 UI ✅ 완료

- [x] **네비게이션 바에 로그아웃 버튼 추가**
  - [x] 로그인 상태 표시
  - [x] 사용자 이름 표시
  - [x] 로그아웃 버튼
  - [x] 프로필 링크

- [x] **세션 상태 관리**
  - [x] `useGetSession` 훅 활용
  - [x] 로그인/로그아웃 상태에 따른 UI 변경
  - [x] 자동 토큰 갱신 처리

### 🟡 중간 우선순위 (권장 구현)

#### 4. 사용자 관리 페이지들

- [ ] **사용자 목록 페이지** (`/users`)
  - [ ] `app/(users)/users/page.tsx` 생성
  - [ ] `app/(users)/users/_components/UserList.tsx` 생성
  - [ ] 페이지네이션 구현
  - [ ] 검색 기능 (선택사항)
  - [ ] `useGetUsers` 훅 연동

- [ ] **사용자 상세 페이지** (`/users/[userId]`)
  - [ ] `app/(users)/users/[userId]/page.tsx` 생성
  - [ ] `app/(users)/users/[userId]/_components/UserDetail.tsx` 생성
  - [ ] 동적 라우트 파라미터 처리
  - [ ] 사용자 상세 정보 표시
  - [ ] `useGetUser` 훅 연동

#### 5. 레이아웃 개선

- [ ] **프로필 레이아웃** (`app/(profile)/layout.tsx`)
  - [ ] 프로필 관련 페이지 공통 레이아웃
  - [ ] 사이드바 네비게이션
  - [ ] 브레드크럼

- [ ] **사용자 레이아웃** (`app/(users)/layout.tsx`)
  - [ ] 사용자 관련 페이지 공통 레이아웃
  - [ ] 관리자 권한 체크

### 🟢 낮은 우선순위 (선택 구현)

#### 6. 추가 기능

- [ ] **관리자 대시보드** (`/admin`)
  - [ ] 사용자 통계
  - [ ] 시스템 모니터링
  - [ ] 관리자 전용 기능

- [ ] **에러 페이지 개선**
  - [ ] 403 Forbidden 페이지
  - [ ] 500 Internal Server Error 페이지
  - [ ] 커스텀 에러 바운더리

- [ ] **로딩 상태 개선**
  - [ ] 스켈레톤 로딩
  - [ ] 스피너 컴포넌트
  - [ ] 로딩 상태 관리

## 기술적 고려사항

### 인증 및 권한 ✅ 완료

- [x] JWT 토큰 기반 인증
- [x] 쿠키 기반 토큰 저장
- [x] 권한별 라우트 보호
- [x] 자동 토큰 갱신

### 성능 최적화 ✅ 완료

- [x] React Query 캐싱 활용
- [x] 코드 스플리팅
- [x] 이미지 최적화
- [x] 번들 크기 최적화

### 사용자 경험 ✅ 완료

- [x] 반응형 디자인
- [x] 접근성 (a11y) 고려
- [x] 다크모드 지원 (선택사항)
- [x] 국제화 (i18n) 지원 (선택사항)

## 완료된 작업 ✅

1. **인증 관련 모든 페이지** - 로그인, 회원가입, 비밀번호 찾기, 새 비밀번호 설정
2. **홈 페이지** - 메인 페이지 구현
3. **공통 레이아웃** - 최상위 레이아웃 및 404 페이지
4. **홈 링크 추가** - 모든 인증 폼에 홈으로 돌아가기 링크 추가
5. **API 연동** - 모든 인증 관련 훅 구현 및 연동
6. **세션 관리 UI** - AuthButtons 컴포넌트로 로그인/로그아웃 상태 관리
7. **엔티티 구조** - auth, users 엔티티 및 모든 관련 훅 구현
8. **React Query 설정** - 모든 API 호출에 대한 훅 구현
9. **프로필 수정 UI** - ProfileEditForm 컴포넌트 구현 (API 호환성 문제 있음)

## 부분 완료된 작업 ⚠️

1. **프로필 수정 기능** - UI는 완료되었지만 Zod 호환성 문제로 작동하지 않음

## 다음 단계

### 즉시 해결 필요

1. **Zod 호환성 문제 해결**
   - nestjs-zod 제거 또는 Zod v3 다운그레이드
   - 직접 Zod 검증 구현 고려

2. **프로필 수정 기능 정상화**
   - API 호환성 문제 해결 후 테스트
   - 에러 처리 개선

### 이후 구현

3. **나머지 프로필 관리 페이지들 완성**
   - 프로필 조회 페이지
   - 비밀번호 변경 페이지
   - 회원탈퇴 페이지

현재 인증 시스템과 세션 관리가 완료되어 있고, 프로필 수정 UI도 구현되어 있어서, Zod 호환성 문제만 해결하면 기본적인 사용자 경험이 완성됩니다.
